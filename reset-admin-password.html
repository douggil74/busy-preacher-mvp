<!DOCTYPE html>
<html>
<head>
    <title>Reset Admin Password - Busy Preacher</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #0f172a;
            color: #fff;
        }
        .container {
            background: #1e293b;
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #334155;
        }
        h1 {
            color: #f59e0b;
            margin-top: 0;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        .danger {
            background: #ef4444;
        }
        .danger:hover {
            background: #dc2626;
        }
        .info {
            background: #334155;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
        }
        .success {
            background: #10b981;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        input {
            width: 100%;
            padding: 10px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 6px;
            color: white;
            margin: 10px 0;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Admin Password Debugger</h1>

        <h3>Current Storage State:</h3>
        <div id="status" class="info">Loading...</div>

        <h3>Actions:</h3>
        <button onclick="checkPassword()">Check Current Password</button>
        <button onclick="resetToDefault()" class="danger">Reset to Default Password</button>
        <button onclick="clearAll()" class="danger">Clear All Admin Data</button>

        <h3>Test Login:</h3>
        <input type="text" id="testPassword" placeholder="Enter password to test">
        <button onclick="testPassword()">Test This Password</button>

        <h3>Set Custom Password:</h3>
        <input type="text" id="customPassword" placeholder="Enter new password">
        <button onclick="setCustomPassword()">Set Custom Password</button>

        <div id="result"></div>
    </div>

    <script>
        const DEFAULT_PASSWORD = '2627f68597G!';
        const STORAGE_KEY = 'bc-admin-password';

        function updateStatus() {
            const stored = localStorage.getItem(STORAGE_KEY);
            const sessionAuth = sessionStorage.getItem('admin-authenticated');

            document.getElementById('status').innerHTML = `
                <strong>localStorage[${STORAGE_KEY}]:</strong><br>
                ${stored || '(not set)'}<br><br>
                <strong>Session authenticated:</strong><br>
                ${sessionAuth || '(not set)'}<br><br>
                <strong>All localStorage keys:</strong><br>
                ${Object.keys(localStorage).filter(k => k.startsWith('bc-')).join(', ') || '(none)'}
            `;
        }

        function checkPassword() {
            const stored = localStorage.getItem(STORAGE_KEY);
            const defaultHash = btoa(DEFAULT_PASSWORD);

            let msg = `<strong>Stored password hash:</strong> ${stored || '(none)'}<br>`;
            msg += `<strong>Default password hash:</strong> ${defaultHash}<br>`;
            msg += `<strong>Default password:</strong> ${DEFAULT_PASSWORD}<br>`;
            msg += `<strong>Match:</strong> ${stored === defaultHash ? '✅ YES' : '❌ NO'}`;

            showResult(msg, stored === defaultHash);
        }

        function resetToDefault() {
            if (!confirm('Reset password to default: ' + DEFAULT_PASSWORD)) return;

            const hashed = btoa(DEFAULT_PASSWORD);
            localStorage.setItem(STORAGE_KEY, hashed);
            sessionStorage.removeItem('admin-authenticated');

            showResult(`✅ Password reset to default:<br><strong>${DEFAULT_PASSWORD}</strong>`, true);
            updateStatus();
        }

        function clearAll() {
            if (!confirm('Clear ALL admin data? This will log you out.')) return;

            localStorage.removeItem(STORAGE_KEY);
            sessionStorage.removeItem('admin-authenticated');

            showResult('✅ All admin data cleared. Refresh the admin page to reinitialize.', true);
            updateStatus();
        }

        function testPassword() {
            const password = document.getElementById('testPassword').value;
            if (!password) {
                alert('Enter a password to test');
                return;
            }

            const stored = localStorage.getItem(STORAGE_KEY);
            const hashed = btoa(password);

            if (!stored) {
                showResult('❌ No password is stored. Reset to default first.', false);
                return;
            }

            const matches = stored === hashed;
            const msg = matches
                ? `✅ Password "${password}" is CORRECT!`
                : `❌ Password "${password}" is INCORRECT.<br>Stored hash: ${stored}<br>Your hash: ${hashed}`;

            showResult(msg, matches);
        }

        function setCustomPassword() {
            const password = document.getElementById('customPassword').value;
            if (!password) {
                alert('Enter a password');
                return;
            }

            if (password.length < 6) {
                alert('Password must be at least 6 characters');
                return;
            }

            const hashed = btoa(password);
            localStorage.setItem(STORAGE_KEY, hashed);
            sessionStorage.removeItem('admin-authenticated');

            showResult(`✅ Password changed to:<br><strong>${password}</strong>`, true);
            updateStatus();
        }

        function showResult(msg, success) {
            const div = document.getElementById('result');
            div.className = success ? 'success' : 'info';
            div.innerHTML = msg;
        }

        // Initialize
        updateStatus();
    </script>
</body>
</html>
