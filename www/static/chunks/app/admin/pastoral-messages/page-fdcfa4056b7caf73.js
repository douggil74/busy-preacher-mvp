(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4778],{5937:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});let a=(0,s(71847).A)("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]])},18085:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});let a=(0,s(71847).A)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},20063:(e,r,s)=>{"use strict";var a=s(47260);s.o(a,"useParams")&&s.d(r,{useParams:function(){return a.useParams}}),s.o(a,"useRouter")&&s.d(r,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(r,{useSearchParams:function(){return a.useSearchParams}})},23664:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});let a=(0,s(71847).A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},27012:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>u});var a=s(95155),t=s(12115),l=s(35626),o=s(5937),d=s(52056),c=s(23664),n=s(71847);let i=(0,n.A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),x=(0,n.A)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]),m=(0,n.A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var h=s(18085),p=s(20063),b=s(88371);function u(){var e;let r=(0,p.useRouter)(),[s,n]=(0,t.useState)([]),[u,g]=(0,t.useState)(null),[v,y]=(0,t.useState)([]),[j,f]=(0,t.useState)(""),[N,k]=(0,t.useState)(!0),[w,C]=(0,t.useState)(!1),[_,A]=(0,t.useState)("all");(0,t.useEffect)(()=>{S();let e=setInterval(S,3e4);return()=>clearInterval(e)},[_]);let S=async()=>{try{let e="/api/pastoral-conversations?limit=100";"flagged"===_&&(e+="&flaggedOnly=true"),"contact"===_&&(e+="&hasContact=true");let r=await fetch(e),s=await r.json();n(s.conversations||[])}catch(e){console.error("Failed to fetch conversations:",e)}finally{k(!1)}},P=async e=>{try{let r=await fetch("/api/pastoral-messages?conversationId=".concat(e)),s=await r.json();y(s.messages||[])}catch(e){console.error("Failed to fetch messages:",e)}},W=async e=>{if(e.preventDefault(),j.trim()&&u){C(!0);try{let e=await fetch("/api/pastoral-messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:u.id,sender:"pastor",message:j.trim()})});if(e.ok){let{message:r}=await e.json();y([...v,r]),f(""),S()}}catch(e){console.error("Failed to send message:",e)}finally{C(!1)}}},M=s.filter(e=>{var r;return null==(r=e.latest_message)?void 0:r.flagged_serious}).length,F=s.filter(e=>e.contact_email).length;return(0,a.jsx)(b.A,{children:(0,a.jsxs)("div",{className:"min-h-screen",style:{background:"var(--bg-primary)"},children:[(0,a.jsx)("div",{className:"sticky top-0 z-10 backdrop-blur-sm",style:{backgroundColor:"var(--card-bg)",borderBottomWidth:"1px",borderBottomStyle:"solid",borderBottomColor:"var(--card-border)"},children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("button",{onClick:()=>r.push("/admin"),className:"p-2 rounded-lg transition-colors",style:{backgroundColor:"var(--card-hover)",color:"var(--text-secondary)"},children:(0,a.jsx)(l.A,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:"Pastoral Messages"}),(0,a.jsx)("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"View and respond to pastoral guidance conversations"})]})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"rounded-lg p-4",style:{backgroundColor:"var(--card-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--card-border)"},children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(o.A,{className:"w-5 h-5 text-blue-400"}),(0,a.jsx)("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"Total Conversations"})]}),(0,a.jsx)("p",{className:"text-3xl font-bold text-blue-400",children:s.length})]}),(0,a.jsxs)("div",{className:"rounded-lg p-4",style:{backgroundColor:"var(--card-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--card-border)"},children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(d.A,{className:"w-5 h-5 text-red-400"}),(0,a.jsx)("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"Flagged"})]}),(0,a.jsx)("p",{className:"text-3xl font-bold text-red-400",children:M})]}),(0,a.jsxs)("div",{className:"rounded-lg p-4",style:{backgroundColor:"var(--card-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--card-border)"},children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(c.A,{className:"w-5 h-5 text-green-400"}),(0,a.jsx)("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"Contact Provided"})]}),(0,a.jsx)("p",{className:"text-3xl font-bold text-green-400",children:F})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,a.jsxs)("button",{onClick:()=>A("all"),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("all"===_?"bg-blue-500 text-white":""),style:"all"!==_?{backgroundColor:"var(--card-bg)",color:"var(--text-secondary)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--card-border)"}:void 0,children:["All (",s.length,")"]}),(0,a.jsxs)("button",{onClick:()=>A("flagged"),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("flagged"===_?"bg-red-500 text-white":""),style:"flagged"!==_?{backgroundColor:"var(--card-bg)",color:"var(--text-secondary)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--card-border)"}:void 0,children:["Flagged (",M,")"]}),(0,a.jsxs)("button",{onClick:()=>A("contact"),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("contact"===_?"bg-green-500 text-white":""),style:"contact"!==_?{backgroundColor:"var(--card-bg)",color:"var(--text-secondary)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--card-border)"}:void 0,children:["Has Contact (",F,")"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",style:{height:"calc(100vh - 400px)"},children:[(0,a.jsxs)("div",{className:"col-span-1 rounded-lg overflow-hidden",style:{backgroundColor:"var(--card-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--card-border)"},children:[(0,a.jsx)("div",{className:"p-4 border-b",style:{borderColor:"var(--card-border)"},children:(0,a.jsx)("h2",{className:"font-bold",style:{color:"var(--text-primary)"},children:"Conversations"})}),(0,a.jsx)("div",{className:"overflow-y-auto",style:{height:"calc(100% - 60px)"},children:N?(0,a.jsx)("div",{className:"p-4 text-center",style:{color:"var(--text-secondary)"},children:"Loading..."}):0===s.length?(0,a.jsx)("div",{className:"p-4 text-center",style:{color:"var(--text-secondary)"},children:"No conversations yet"}):s.map(e=>{var r;return(0,a.jsxs)("button",{onClick:()=>{g(e),P(e.id)},className:"w-full p-4 text-left border-b transition-colors ".concat((null==u?void 0:u.id)===e.id?"bg-blue-500/10":""),style:{borderColor:"var(--card-border)",backgroundColor:(null==u?void 0:u.id)===e.id?void 0:"transparent"},children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i,{className:"w-4 h-4",style:{color:"var(--text-secondary)"}}),(0,a.jsx)("span",{className:"font-semibold",style:{color:"var(--text-primary)"},children:e.first_name})]}),(null==(r=e.latest_message)?void 0:r.flagged_serious)&&(0,a.jsx)(d.A,{className:"w-4 h-4 text-red-500"})]}),e.contact_email&&(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,a.jsx)(c.A,{className:"w-3 h-3 text-green-500"}),(0,a.jsx)("span",{className:"text-xs text-green-500",children:e.contact_email})]}),e.contact_phone&&(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-2",children:[(0,a.jsx)(x,{className:"w-3 h-3 text-green-500"}),(0,a.jsx)("span",{className:"text-xs text-green-500",children:e.contact_phone})]}),e.latest_message&&(0,a.jsx)("p",{className:"text-sm line-clamp-2 mb-2",style:{color:"var(--text-secondary)"},children:e.latest_message.message}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs",style:{color:"var(--text-secondary)"},children:[(0,a.jsx)(m,{className:"w-3 h-3"}),new Date(e.last_activity).toLocaleString()]}),e.unread_count>0&&(0,a.jsxs)("div",{className:"mt-2 inline-block px-2 py-0.5 bg-blue-500 text-white text-xs rounded-full",children:[e.unread_count," unread"]})]},e.id)})})]}),(0,a.jsx)("div",{className:"col-span-2 rounded-lg overflow-hidden flex flex-col",style:{backgroundColor:"var(--card-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--card-border)"},children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"p-4 border-b",style:{borderColor:"var(--card-border)"},children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-bold text-lg",style:{color:"var(--text-primary)"},children:u.first_name}),u.contact_email&&(0,a.jsxs)("p",{className:"text-sm text-green-500",children:[u.contact_email,u.contact_phone&&" â€¢ ".concat(u.contact_phone)]})]}),(null==(e=u.latest_message)?void 0:e.flagged_serious)&&(0,a.jsx)("div",{className:"px-3 py-1 bg-red-500/20 border border-red-500 rounded-full",children:(0,a.jsx)("span",{className:"text-xs font-semibold text-red-500",children:"FLAGGED"})})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:v.map(e=>(0,a.jsx)("div",{className:"flex ".concat("pastor"===e.sender?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[80%] ".concat(e.is_ai_response?"opacity-60":""),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"text-xs font-semibold",style:{color:"var(--text-secondary)"},children:"pastor"===e.sender?"You (Pastor)":"user"===e.sender?u.first_name:"AI"}),e.is_ai_response&&(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 bg-blue-500/20 text-blue-500 rounded",children:"AI"}),e.flagged_serious&&(0,a.jsx)(d.A,{className:"w-3 h-3 text-red-500"})]}),(0,a.jsx)("div",{className:"px-4 py-2 rounded-lg ".concat("pastor"===e.sender?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-800"),style:"pastor"!==e.sender?{backgroundColor:"var(--card-hover)",color:"var(--text-primary)"}:void 0,children:(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.message})}),(0,a.jsx)("p",{className:"text-xs mt-1",style:{color:"var(--text-secondary)"},children:new Date(e.created_at).toLocaleString()})]})},e.id))}),(0,a.jsx)("form",{onSubmit:W,className:"p-4 border-t",style:{borderColor:"var(--card-border)"},children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:j,onChange:e=>f(e.target.value),placeholder:"Write a personal message...",disabled:w,className:"flex-1 px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",style:{backgroundColor:"var(--input-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--input-border)",color:"var(--text-primary)"}}),(0,a.jsxs)("button",{type:"submit",disabled:!j.trim()||w,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50 flex items-center gap-2",children:[(0,a.jsx)(h.A,{className:"w-4 h-4"}),"Send"]})]})})]}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",style:{color:"var(--text-secondary)"},children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(o.A,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:"Select a conversation to view messages"})]})})})]})]})]})})}},35626:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});let a=(0,s(71847).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},52056:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});let a=(0,s(71847).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},81081:(e,r,s)=>{Promise.resolve().then(s.bind(s,27012))}},e=>{e.O(0,[4077,8371,8441,1255,7358],()=>e(e.s=81081)),_N_E=e.O()}]);