(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1024],{4066:e=>{e.exports={style:{fontFamily:"'Playfair Display', 'Playfair Display Fallback'",fontStyle:"normal"},className:"__className_58c889"}},5937:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]])},18085:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},20063:(e,t,r)=>{"use strict";var a=r(47260);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},23664:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},29293:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,O:()=>l});var a=r(95155),o=r(12115);let s=(0,o.createContext)(void 0);function l(e){let{children:t}=e;return(0,a.jsx)(s.Provider,{value:{user:null,isAuthenticated:!1,isLoading:!1,signOut:async()=>{}},children:t})}function i(){let e=(0,o.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},35626:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},52056:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},53017:(e,t,r)=>{Promise.resolve().then(r.bind(r,59172))},59172:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>w});var a=r(95155),o=r(12115),s=r(35626);let l=(0,r(71847).A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);var i=r(23664),n=r(18085),d=r(5937),c=r(20063),u=r(4066),m=r.n(u),x=r(60845),p=r(65229);function h(e){let{isOpen:t,onClose:r,isCrisis:s,sessionId:l,firstName:i}=e,[n,d]=(0,o.useState)(""),[c,u]=(0,o.useState)(""),[m,x]=(0,o.useState)(!1);if((0,o.useEffect)(()=>{if(t){let e=localStorage.getItem("bc-user-email")||"",t=localStorage.getItem("bc-user-phone")||"";d(e),u(t)}},[t]),!t)return null;let h=async e=>{if(e.preventDefault(),n.trim()){x(!0);try{localStorage.setItem("bc-user-email",n.trim()),c.trim()&&localStorage.setItem("bc-user-phone",c.trim()),await fetch("/api/pastoral-contact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:l,firstName:i,email:n.trim(),phone:c.trim()})}),r()}catch(e){console.error("Failed to save contact info:",e)}finally{x(!1)}}},b=()=>{r()};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/30 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"max-w-md w-full rounded-2xl shadow-xl overflow-hidden",style:{backgroundColor:"var(--card-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--card-border)"},children:[(0,a.jsx)("div",{className:"px-6 py-5",style:{background:s?"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)":"linear-gradient(135deg, #10b981 0%, #3b82f6 100%)"},children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-1",children:s?"\uD83D\uDC99 I'm Here for You":"\uD83E\uDD1D Let's Talk"}),(0,a.jsx)("p",{className:"text-sm text-white/90",children:s?"I care about you and want to help personally":"This might be something we should talk through together"})]}),(0,a.jsx)("button",{onClick:b,className:"ml-2 p-1 hover:bg-white/20 rounded-lg transition-colors",children:(0,a.jsx)(p.A,{className:"w-5 h-5 text-white"})})]})}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("p",{className:"text-sm mb-4",style:{color:"var(--text-primary)"},children:s?(0,a.jsxs)(a.Fragment,{children:["While the AI can provide guidance, I really want to be there for you personally.",(0,a.jsx)("strong",{className:"block mt-2",children:"Would you let me reach out to check on you?"})]}):(0,a.jsxs)(a.Fragment,{children:["The AI did its best, but some things are better talked through in person.",(0,a.jsx)("strong",{className:"block mt-2",children:"Want to continue this conversation with me directly?"})]})}),(0,a.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:["Email Address ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"email",value:n,onChange:e=>d(e.target.value),placeholder:"your.email@example.com",required:!0,className:"w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",style:{backgroundColor:"var(--input-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--input-border)",color:"var(--text-primary)"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:["Phone Number ",(0,a.jsx)("span",{className:"text-xs",style:{color:"var(--text-secondary)"},children:"(optional)"})]}),(0,a.jsx)("input",{type:"tel",value:c,onChange:e=>u(e.target.value),placeholder:"(555) 123-4567",className:"w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500",style:{backgroundColor:"var(--input-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--input-border)",color:"var(--text-primary)"}})]}),(0,a.jsx)("div",{className:"rounded-lg p-3",style:{backgroundColor:"color-mix(in srgb, var(--accent-color) 10%, transparent)",borderWidth:"1px",borderStyle:"solid",borderColor:"color-mix(in srgb, var(--accent-color) 30%, transparent)"},children:(0,a.jsx)("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:"\uD83D\uDD12 Your contact info is kept private and only shared with Pastor Doug. You'll also be able to message back and forth through the app."})}),(0,a.jsx)("div",{className:"flex gap-3",children:(0,a.jsx)("button",{type:"submit",disabled:m||!n.trim(),className:"flex-1 px-4 py-3 rounded-lg font-semibold transition-all disabled:opacity-50 hover:opacity-90",style:{background:s?"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)":"linear-gradient(135deg, #10b981 0%, #3b82f6 100%)",color:"white"},children:m?"Saving...":"Yes, Please Reach Out"})}),(0,a.jsx)("button",{type:"button",onClick:b,className:"w-full text-sm underline transition-colors",style:{color:"var(--text-secondary)"},children:"No thanks, I prefer to stay anonymous"})]})]})]})})}var b=r(52056);function g(e){let{isOpen:t,onSubmit:r,sessionId:s,userEmail:l}=e,[i,n]=(0,o.useState)(""),[d,c]=(0,o.useState)(""),[u,m]=(0,o.useState)(""),[x,p]=(0,o.useState)(""),[h,g]=(0,o.useState)(!1);if((0,o.useEffect)(()=>{if(t&&!i&&!d&&!u&&!x){let e=localStorage.getItem("bc-user-fullname")||"",t=localStorage.getItem("bc-user-age")||"",r=localStorage.getItem("bc-user-phone")||"",a=localStorage.getItem("bc-user-address")||"";n(e),c(t),m(r),p(a)}},[t]),!t)return null;let y=async e=>{e.preventDefault(),g(!0);try{localStorage.setItem("bc-user-fullname",i.trim()),localStorage.setItem("bc-user-age",d.trim()),localStorage.setItem("bc-user-phone",u.trim()),localStorage.setItem("bc-user-address",x.trim()),await fetch("/api/mandatory-report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:s,fullName:i.trim(),age:d.trim(),phone:u.trim(),address:x.trim(),googleEmail:l||null})}),r({fullName:i.trim(),age:d.trim(),phone:u.trim(),address:x.trim(),googleEmail:l})}catch(e){console.error("Failed to submit mandatory report:",e),alert("Failed to submit information. Please try again.")}finally{g(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"max-w-md w-full rounded-2xl shadow-xl overflow-hidden",style:{backgroundColor:"var(--card-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--card-border)"},children:[(0,a.jsx)("div",{className:"px-6 py-5",style:{background:"linear-gradient(135deg, #dc2626 0%, #991b1b 100%)"},children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(b.A,{className:"w-6 h-6 text-white flex-shrink-0 mt-1"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-1",children:"Mandatory Reporting Required"}),(0,a.jsx)("p",{className:"text-sm text-white/90",children:"By law, I must report child abuse to authorities"})]})]})}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-4 p-3 rounded-lg",style:{backgroundColor:"color-mix(in srgb, #10b981 15%, var(--card-bg))",borderWidth:"1px",borderStyle:"solid",borderColor:"color-mix(in srgb, #10b981 30%, transparent)"},children:[(0,a.jsx)("p",{className:"text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:(0,a.jsx)("strong",{children:"✅ Pastor Doug has been notified"})}),(0,a.jsxs)("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:["He already has your conversation and technical information for authorities.",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"Optional:"})," You can provide additional contact info below if you want him to reach out directly. Otherwise, you can skip this."]})]}),(0,a.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:["Full Name ",(0,a.jsx)("span",{className:"text-xs opacity-60",children:"(optional)"})]}),(0,a.jsx)("input",{type:"text",value:i,onChange:e=>n(e.target.value),placeholder:"First and Last Name",className:"w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",style:{backgroundColor:"var(--input-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--input-border)",color:"var(--text-primary)"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:["Age ",(0,a.jsx)("span",{className:"text-xs opacity-60",children:"(optional)"})]}),(0,a.jsx)("input",{type:"number",value:d,onChange:e=>c(e.target.value),placeholder:"Your age",min:"0",max:"17",className:"w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",style:{backgroundColor:"var(--input-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--input-border)",color:"var(--text-primary)"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:["Phone Number ",(0,a.jsx)("span",{className:"text-xs opacity-60",children:"(optional)"})]}),(0,a.jsx)("input",{type:"tel",value:u,onChange:e=>m(e.target.value),placeholder:"(555) 123-4567",className:"w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",style:{backgroundColor:"var(--input-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--input-border)",color:"var(--text-primary)"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:["Address / Location ",(0,a.jsx)("span",{className:"text-xs opacity-60",children:"(optional)"})]}),(0,a.jsx)("textarea",{value:x,onChange:e=>p(e.target.value),placeholder:"Street address, city, and zip code",rows:3,className:"w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",style:{backgroundColor:"var(--input-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--input-border)",color:"var(--text-primary)"}})]}),l&&(0,a.jsx)("div",{className:"rounded-lg p-3",style:{backgroundColor:"color-mix(in srgb, var(--accent-color) 10%, transparent)",borderWidth:"1px",borderStyle:"solid",borderColor:"color-mix(in srgb, var(--accent-color) 30%, transparent)"},children:(0,a.jsxs)("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:["✓ Signed in as: ",(0,a.jsx)("strong",{children:l})]})}),(0,a.jsx)("button",{type:"submit",disabled:h||!i.trim()||!d.trim()||!u.trim()||!x.trim(),className:"w-full px-4 py-3 rounded-lg font-semibold transition-all disabled:opacity-50",style:{background:"linear-gradient(135deg, #dc2626 0%, #991b1b 100%)",color:"white"},children:h?"Sending...":"Send My Info (Optional)"}),(0,a.jsx)("button",{type:"button",onClick:()=>r({fullName:"",age:"",phone:"",address:"",googleEmail:l}),className:"w-full text-sm underline transition-colors",style:{color:"var(--text-secondary)"},children:"Skip - Pastor already has what he needs"})]})]})]})})}function y(e){let{sessionId:t,firstName:r}=e,[s,l]=(0,o.useState)(!1),[i,c]=(0,o.useState)(!1),[u,m]=(0,o.useState)([]),[x,h]=(0,o.useState)(""),[b,g]=(0,o.useState)(!1),[y,f]=(0,o.useState)(null);(0,o.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/pastoral-messages?sessionId=".concat(t)),r=await e.json();r.conversation&&(f(r.conversation.id),l(r.hasUnread),m(r.messages||[]))}catch(e){console.error("Failed to check unread messages:",e)}};e();let r=setInterval(e,3e4);return()=>clearInterval(r)},[t]);let v=async e=>{if(e.preventDefault(),x.trim()&&y){g(!0);try{let e=await fetch("/api/pastoral-messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:y,sender:"user",message:x.trim()})});if(e.ok){let{message:t}=await e.json();m([...u,t]),h("")}}catch(e){console.error("Failed to send reply:",e)}finally{g(!1)}}};return s||i?(0,a.jsxs)(a.Fragment,{children:[s&&!i&&(0,a.jsxs)("button",{onClick:()=>c(!0),className:"fixed bottom-24 right-6 z-40 flex items-center gap-2 px-4 py-3 bg-gradient-to-br from-amber-500 to-amber-600 text-white rounded-full shadow-lg hover:shadow-xl transition-all animate-pulse",children:[(0,a.jsx)(d.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-semibold",children:"Pastor Doug sent you a message!"})]}),i&&(0,a.jsxs)("div",{className:"fixed bottom-4 right-4 z-40 w-96 max-h-[600px] flex flex-col rounded-2xl shadow-2xl overflow-hidden",style:{backgroundColor:"var(--card-bg)",borderWidth:"2px",borderStyle:"solid",borderColor:"var(--card-border)"},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-br from-amber-500 to-amber-600",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center text-white font-bold text-sm",children:"P"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-bold text-white",children:"Pastor Doug"}),(0,a.jsx)("p",{className:"text-xs text-white/80",children:"Private conversation"})]})]}),(0,a.jsx)("button",{onClick:()=>c(!1),className:"p-1 hover:bg-white/20 rounded-lg transition-colors",children:(0,a.jsx)(p.A,{className:"w-5 h-5 text-white"})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",style:{maxHeight:"400px"},children:u.filter(e=>!e.is_ai_response).map(e=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.sender?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[80%] px-3 py-2 rounded-lg ".concat("user"===e.sender?"bg-blue-500 text-white":"bg-amber-100 dark:bg-amber-900/30 text-amber-900 dark:text-amber-100"),children:[(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.message}),(0,a.jsx)("p",{className:"text-xs mt-1 opacity-70",children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e.id))}),(0,a.jsx)("form",{onSubmit:v,className:"border-t p-3",style:{borderColor:"var(--card-border)"},children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:x,onChange:e=>h(e.target.value),placeholder:"Reply to Pastor Doug...",disabled:b,className:"flex-1 px-3 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-amber-500",style:{backgroundColor:"var(--input-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--input-border)",color:"var(--text-primary)"}}),(0,a.jsx)("button",{type:"submit",disabled:!x.trim()||b,className:"px-3 py-2 bg-gradient-to-br from-amber-500 to-amber-600 text-white rounded-lg hover:shadow-lg transition-all disabled:opacity-50",children:(0,a.jsx)(n.A,{className:"w-4 h-4"})})]})})]})]}):null}var f=r(29293),v=r(55172);function w(){let e=(0,c.useRouter)(),{user:t}=(0,f.A)(),[r,u]=(0,o.useState)([]),[p,b]=(0,o.useState)(""),[w,j]=(0,o.useState)(!1),[N,S]=(0,o.useState)(""),[k,C]=(0,o.useState)(""),[P,I]=(0,o.useState)(null),[A,D]=(0,o.useState)(!1),[F,E]=(0,o.useState)(!1),[O,T]=(0,o.useState)(!1),[W,z]=(0,o.useState)(!1),[L,R]=(0,o.useState)(!1),M=(0,o.useRef)(null),_=(0,o.useRef)(new Set),q=async()=>{if(0===r.length)return;let e=J();if(!e)return void alert("Please provide your email address in the contact form first.");R(!0);try{if(!(await fetch("/api/pastoral-transcript",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,firstName:N,messages:r.map(e=>({role:e.role,content:e.content,timestamp:e.timestamp.toISOString()}))})})).ok)throw Error("Failed to send email");alert("Transcript sent! Check your email.")}catch(e){console.error("Failed to email transcript:",e),alert("Failed to send email. Please try again.")}finally{R(!1)}};(0,o.useEffect)(()=>{S(localStorage.getItem("bc-user-name")||"Anonymous");let e=localStorage.getItem("bc-pastoral-session-id");e||(e="session_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),localStorage.setItem("bc-pastoral-session-id",e)),C(e)},[]),(0,o.useEffect)(()=>{(async()=>{if(k&&N)try{let e=await fetch("/api/pastoral-conversations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:k,firstName:N})});if(!e.ok)return void console.error("Failed to create conversation:",e.status);let t=e.headers.get("content-type");if(!t||!t.includes("application/json"))return void console.error("Expected JSON response but got:",t);let r=await e.json();r.conversation&&I(r.conversation.id)}catch(e){console.error("Failed to create conversation:",e)}})()},[k,N]);let J=()=>localStorage.getItem("bc-user-email")||void 0;(0,o.useEffect)(()=>{var e;null==(e=M.current)||e.scrollIntoView({behavior:"smooth"})},[r]);let H=async e=>{if(e.preventDefault(),!p.trim()||w)return;let t={id:Date.now().toString(),role:"user",content:p.trim(),timestamp:new Date};u(e=>[...e,t]),b(""),j(!0);try{let e=await fetch("/api/pastoral-guidance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:t.content,conversationHistory:r.slice(-4),userName:N,userEmail:J(),sessionId:k})});if(!e.ok)throw Error("API error: ".concat(e.status));let a=e.headers.get("content-type");if(!a||!a.includes("application/json"))throw Error("Expected JSON but got ".concat(a));let o=await e.json(),s={id:(Date.now()+1).toString(),role:"assistant",content:o.answer,timestamp:new Date};u(e=>[...e,s]);let l=o.isCrisis||!1,i=o.isSerious||!1,n=o.isMandatoryReport||!1;if(P)try{await fetch("/api/pastoral-messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:P,sender:"user",message:t.content,isAiResponse:!1,flaggedSerious:l||i})}),await fetch("/api/pastoral-messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:P,sender:"assistant",message:o.answer,isAiResponse:!0,flaggedSerious:l||i})})}catch(e){console.error("Failed to save messages:",e)}n&&!_.current.has(s.id)?(_.current.add(s.id),setTimeout(()=>{T(!0)},500)):(l||i)&&!_.current.has(s.id)&&(_.current.add(s.id),E(l),setTimeout(()=>{D(!0)},500));try{await fetch("/api/guidance-logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:N,question:t.content,answer:o.answer,flagged:l||i})})}catch(e){console.error("Failed to log question:",e)}}catch(t){console.error("Error:",t);let e={id:(Date.now()+1).toString(),role:"assistant",content:"I apologize, but I encountered an error. Please try again.",timestamp:new Date};u(t=>[...t,e])}finally{j(!1)}};return(0,a.jsxs)("div",{className:"min-h-screen",style:{background:"var(--bg-primary)"},children:[(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("button",{onClick:()=>e.push("/"),className:"flex items-center gap-2 text-sm transition-colors",style:{color:"var(--text-secondary)"},children:[(0,a.jsx)(s.A,{className:"w-4 h-4"}),"Back"]}),r.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("button",{onClick:()=>{if(0!==r.length){z(!0);try{let e=new v.default,t=e.internal.pageSize.getWidth(),a=t-30,o=20;e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Pastoral Guidance Conversation",15,o),o+=10,e.setFontSize(10),e.setFont("helvetica","normal"),e.text(new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"}),15,o),o+=15,r.forEach((t,r)=>{let s="user"===t.role?N||"You":"Pastor Doug",l=new Date(t.timestamp).toLocaleString("en-US",{hour:"numeric",minute:"2-digit"});o>270&&(e.addPage(),o=20),e.setFontSize(11),e.setFont("helvetica","bold"),e.text("".concat(s," - ").concat(l),15,o),o+=6,e.setFontSize(10),e.setFont("helvetica","normal"),e.splitTextToSize(t.content,a).forEach(t=>{o>275&&(e.addPage(),o=20),e.text(t,15,o),o+=5}),o+=8});let s=e.getNumberOfPages();for(let r=1;r<=s;r++)e.setPage(r),e.setFontSize(8),e.setFont("helvetica","italic"),e.text("The Busy Christian - Cornerstone Church, Mandeville, LA",t/2,e.internal.pageSize.getHeight()-10,{align:"center"});let l="pastoral-guidance-".concat(new Date().toISOString().split("T")[0],".pdf");e.save(l)}catch(e){console.error("Failed to export PDF:",e),alert("Failed to export PDF. Please try again.")}finally{z(!1)}}},disabled:W,className:"flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all hover:opacity-80 disabled:opacity-50",style:{backgroundColor:"var(--card-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--card-border)",color:"var(--text-primary)"},title:"Export conversation to PDF",children:[(0,a.jsx)(l,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:W?"Exporting...":"PDF"})]}),(0,a.jsxs)("button",{onClick:q,disabled:L,className:"flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all hover:opacity-80 disabled:opacity-50",style:{backgroundColor:"var(--card-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--card-border)",color:"var(--text-primary)"},title:"Email transcript to yourself",children:[(0,a.jsx)(i.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:L?"Sending...":"Email"})]})]})]}),(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("h1",{className:(0,x.cn)(m().className,x.Il.h1,"mb-3"),style:{color:"var(--text-primary)"},children:"Ask the Pastor"}),(0,a.jsx)("div",{className:"h-[2px] w-24 bg-gradient-to-r from-yellow-400 to-amber-400 mx-auto mb-3"}),(0,a.jsx)("p",{className:(0,x.cn)(x.Il.body),style:{color:"var(--text-secondary)"},children:"Biblical wisdom and guidance for life's questions - ask anything on your heart"})]})]}),0===r.length&&(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 pb-4",children:(0,a.jsxs)("form",{onSubmit:H,className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:p,onChange:e=>b(e.target.value),placeholder:"Message Pastor...",disabled:w,className:"flex-1 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400/50 focus:border-yellow-400 transition-all duration-200 disabled:opacity-50",style:{backgroundColor:"var(--input-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--input-border)",color:"var(--text-primary)"}}),(0,a.jsx)("button",{type:"submit",disabled:!p.trim()||w,className:(0,x.cn)(x.x6.primary,"flex items-center gap-2"),children:(0,a.jsx)(n.A,{className:"w-5 h-5"})})]})}),(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-3 pb-24",children:0===r.length?(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"inline-flex p-3 bg-gradient-to-br from-amber-500/10 to-amber-600/10 rounded-full mb-3",children:(0,a.jsx)(d.A,{className:"w-10 h-10 text-amber-500"})}),(0,a.jsx)("h2",{className:(0,x.cn)(x.Il.h3,"mb-2"),style:{color:"var(--text-primary)"},children:"What's on your heart today?"}),(0,a.jsx)("p",{className:(0,x.cn)(x.Il.small,"mb-4 max-w-md mx-auto"),style:{color:"var(--text-secondary)"},children:"No question is too big or too small. Let's talk about what's going on in your life."}),(0,a.jsxs)("div",{className:"max-w-2xl mx-auto mb-4 p-4 rounded-xl text-left",style:{backgroundColor:"var(--card-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--card-border)"},children:[(0,a.jsxs)("p",{className:(0,x.cn)(x.Il.small,"mb-2"),style:{color:"var(--text-primary)"},children:[(0,a.jsx)("strong",{children:"Important:"})," This is AI-assisted spiritual guidance based on pastoral teachings."]}),(0,a.jsxs)("p",{className:(0,x.cn)(x.Il.xs),style:{color:"var(--text-secondary)"},children:["• Not a substitute for professional counseling or medical care",(0,a.jsx)("br",{}),"• For crisis situations, please call 988 (Suicide & Crisis Lifeline) or 911",(0,a.jsx)("br",{}),"• Seek licensed professional help for serious mental health concerns"]})]}),(0,a.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"h-px flex-1",style:{backgroundColor:"var(--card-border)"}}),(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wider",style:{color:"var(--text-secondary)"},children:"Example Questions"}),(0,a.jsx)("div",{className:"h-px flex-1",style:{backgroundColor:"var(--card-border)"}})]}),(0,a.jsx)("div",{className:"grid gap-2",children:["How do I deal with anxiety and fear?","What does the Bible say about forgiveness?","How can I grow closer to God?","How do I handle conflict in relationships?"].map((e,t)=>(0,a.jsx)("button",{onClick:()=>b(e),className:(0,x.cn)(x.x6.secondary,"text-left"),children:e},t))})]})]}):(0,a.jsxs)("div",{className:"space-y-3",children:[r.map(e=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"," items-end gap-2"),children:(0,a.jsxs)("div",{className:"flex flex-col",style:{maxWidth:"70%"},children:["assistant"===e.role&&(0,a.jsx)("p",{className:"text-xs font-medium mb-1 ml-2",style:{color:"var(--text-secondary)"},children:"Pastor"}),(0,a.jsx)("div",{className:(0,x.cn)("px-4 py-2.5 shadow-sm","user"===e.role?"bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-t-2xl rounded-bl-2xl rounded-br-md":"rounded-t-2xl rounded-br-2xl rounded-bl-md"),style:"assistant"===e.role?{backgroundColor:"var(--card-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--card-border)",color:"var(--text-primary)"}:void 0,children:(0,a.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:e.content})}),(0,a.jsx)("p",{className:"text-xs mt-1 px-2",style:{color:"var(--text-secondary)"},children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e.id)),w&&(0,a.jsx)("div",{className:"flex justify-start items-end gap-2",children:(0,a.jsxs)("div",{className:"flex flex-col",style:{maxWidth:"70%"},children:[(0,a.jsx)("p",{className:"text-xs font-medium mb-1 ml-2",style:{color:"var(--text-secondary)"},children:"Pastor"}),(0,a.jsx)("div",{className:"rounded-t-2xl rounded-br-2xl rounded-bl-md px-5 py-3",style:{backgroundColor:"var(--card-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--card-border)"},children:(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-gray-400 animate-bounce",style:{animationDelay:"0ms",animationDuration:"1.4s"}}),(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-gray-400 animate-bounce",style:{animationDelay:"200ms",animationDuration:"1.4s"}}),(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-gray-400 animate-bounce",style:{animationDelay:"400ms",animationDuration:"1.4s"}})]})})]})}),(0,a.jsx)("div",{ref:M})]})}),r.length>0&&(0,a.jsx)("div",{className:"fixed bottom-0 left-0 right-0 backdrop-blur-sm",style:{backgroundColor:"color-mix(in srgb, var(--card-bg) 95%, transparent)",borderTopWidth:"1px",borderTopStyle:"solid",borderTopColor:"var(--card-border)"},children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-3",children:(0,a.jsxs)("form",{onSubmit:H,className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:p,onChange:e=>b(e.target.value),placeholder:"Message Pastor...",disabled:w,className:"flex-1 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400/50 focus:border-yellow-400 transition-all duration-200 disabled:opacity-50",style:{backgroundColor:"var(--input-bg)",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--input-border)",color:"var(--text-primary)"}}),(0,a.jsx)("button",{type:"submit",disabled:!p.trim()||w,className:(0,x.cn)(x.x6.primary,"flex items-center gap-2"),children:(0,a.jsx)(n.A,{className:"w-5 h-5"})})]})})}),k&&(0,a.jsx)(y,{sessionId:k,firstName:N}),(0,a.jsx)(g,{isOpen:O,onSubmit:e=>{T(!1)},sessionId:k,userEmail:J()}),(0,a.jsx)(h,{isOpen:A,onClose:()=>{D(!1)},isCrisis:F,sessionId:k,firstName:N})]})}},60845:(e,t,r)=>{"use strict";r.d(t,{Il:()=>a,Nr:()=>o,cn:()=>i,hF:()=>l,x6:()=>s});let a={h1:"text-3xl font-bold leading-tight",h2:"text-2xl font-semibold leading-snug",h3:"text-xl font-semibold leading-snug",h4:"text-lg font-semibold leading-normal",body:"text-base leading-relaxed",bodyLarge:"text-lg leading-relaxed",small:"text-sm leading-normal",xs:"text-xs leading-tight",quote:"text-lg italic leading-relaxed",code:"font-mono text-sm"},o={base:"rounded-xl p-6 backdrop-blur border",default:"rounded-xl p-6 backdrop-blur border border-white/10 bg-white/5",highlight:"rounded-xl p-6 backdrop-blur border-2 border-yellow-400/30 bg-gradient-to-br from-yellow-400/5 to-transparent",success:"rounded-xl p-6 backdrop-blur border border-green-500/30 bg-green-500/5",warning:"rounded-xl p-6 backdrop-blur border border-amber-500/30 bg-amber-500/5",danger:"rounded-xl p-6 backdrop-blur border border-red-500/30 bg-red-500/5",info:"rounded-xl p-6 backdrop-blur border border-blue-500/30 bg-blue-500/5",spacing:{compact:"p-4",default:"p-6",comfortable:"p-8"},shadow:{none:"",sm:"shadow-sm",md:"shadow-md",lg:"shadow-lg shadow-black/20",xl:"shadow-xl shadow-black/30"}},s={primary:"px-6 py-3 bg-yellow-400 text-slate-900 rounded-lg font-semibold hover:bg-yellow-300 active:scale-95 transition-all shadow-lg shadow-yellow-400/20 disabled:opacity-50 disabled:cursor-not-allowed",secondary:"px-6 py-3 bg-white/10 border border-white/20 text-white rounded-lg font-medium hover:bg-white/15 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed",tertiary:"px-4 py-2 text-yellow-400 hover:text-yellow-300 underline underline-offset-4 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",danger:"px-6 py-3 bg-red-500/10 border border-red-500/30 text-red-500 rounded-lg font-medium hover:bg-red-500/20 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed",success:"px-6 py-3 bg-green-500/10 border border-green-500/30 text-green-500 rounded-lg font-medium hover:bg-green-500/20 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed",ghost:"px-4 py-2 text-white/80 hover:text-white hover:bg-white/5 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",size:{sm:"px-4 py-2 text-sm",md:"px-6 py-3 text-base",lg:"px-8 py-4 text-lg"}},l={base:"w-full px-4 py-3 rounded-lg bg-white/5 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 focus:border-yellow-400 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",withLeftIcon:"w-full pl-10 pr-4 py-3 rounded-lg bg-white/5 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 focus:border-yellow-400 transition-all duration-200",withRightIcon:"w-full pl-4 pr-10 py-3 rounded-lg bg-white/5 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 focus:border-yellow-400 transition-all duration-200",error:"w-full px-4 py-3 rounded-lg bg-red-500/5 border border-red-500/50 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-red-400/50 focus:border-red-400 transition-all duration-200",success:"w-full px-4 py-3 rounded-lg bg-green-500/5 border border-green-500/50 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-green-400/50 focus:border-green-400 transition-all duration-200",textarea:"w-full px-4 py-3 rounded-lg bg-white/5 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 focus:border-yellow-400 transition-all duration-200 min-h-[120px] resize-y"};function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter(Boolean).join(" ")}},65229:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},71847:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var a=r(12115);let o=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},s=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:o=24,strokeWidth:i=2,absoluteStrokeWidth:n,className:d="",children:c,iconNode:u,...m}=e;return(0,a.createElement)("svg",{ref:t,...l,width:o,height:o,stroke:r,strokeWidth:n?24*Number(i)/Number(o):i,className:s("lucide",d),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...u.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(c)?c:[c]])}),n=(e,t)=>{let r=(0,a.forwardRef)((r,l)=>{let{className:n,...d}=r;return(0,a.createElement)(i,{ref:l,iconNode:t,className:s("lucide-".concat(o(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),n),...d})});return r.displayName=o(e),r}}},e=>{e.O(0,[6892,3930,5033,6241,8441,1255,7358],()=>e(e.s=53017)),_N_E=e.O()}]);